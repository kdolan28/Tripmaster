<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Booking Platform</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">Travel Master</div>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="https://www.booking.com" target="_blank">Hotels</a></li>
                <li><a href="/login">Login/Register</a></li>
            </ul>
        </nav>
    </header>

    <!-- Home Page -->
    <main>
        <section class="search-bar">
            <input type="text" id="destinationInput" placeholder="Enter City">
            <input type="date" id="checkInDateInput">
            <input type="date" id="checkOutDateInput">
            <input type="number" id="guestsInput" placeholder="Guests">
            <button type="button" id="searchButton">Search</button>
        </section>
        
       <section class="featured-destinations">
            <h2>Featured Hotels</h2>
            <div class="destination">
                <a href="https://www.booking.com/hotel/cz/step.html?aid=304142&label=gen173rf-1FCAso7AFCJWRvdWJsZXRyZWUtYnktaGlsdG9uLW9ybGFuZG8tZG93bnRvd25IM1gDaLACiAEBmAExuAEXyAEM2AEB6AEB-AECiAIBogIObG9jYWxob3N0OjMwMDCoAgO4ArLg67QGwAIB0gIkMWVmODJlNWItZWE5Ny00YmQzLTg2ZGYtYjRmOTJjYzY2Nzc42AIF4AIB&sid=809d37a05557d3779c8b48d07c093440&all_sr_blocks=7735907_375941460_2_1_0&checkin=2024-07-20&checkout=2024-08-24&dest_id=-553173&dest_type=city&dist=0&group_adults=2&group_children=0&hapos=1&highlighted_blocks=7735907_375941460_2_1_0&hpos=1&matching_block_id=7735907_375941460_2_1_0&no_rooms=1&req_adults=2&req_children=0&room1=A%2CA&sb_price_type=total&sr_order=popularity&sr_pri_blocks=7735907_375941460_2_1_0__590153&srepoch=1721430253&srpvid=0d8ba22e9bda0102&type=total&ucfs=1&activeTab=main" target="_blank">
                    <img src="/images/hotel prague Wellnes.jpg" alt="Wellness Hotel Step" style="width:80%; height:180px;">
                    <p>Wellness Hotel Step, Prague</p>
                </a>
            </div>
            <div class="destination">
                <a href="https://www.booking.com/hotel/fr/card.html?aid=304142&label=gen173rf-1FCAso7AFCJWRvdWJsZXRyZWUtYnktaGlsdG9uLW9ybGFuZG8tZG93bnRvd25IM1gDaLACiAEBmAExuAEXyAEM2AEB6AEB-AECiAIBogIObG9jYWxob3N0OjMwMDCoAgO4ArLg67QGwAIB0gIkMWVmODJlNWItZWE5Ny00YmQzLTg2ZGYtYjRmOTJjYzY2Nzc42AIF4AIB&sid=809d37a05557d3779c8b48d07c093440&all_sr_blocks=995965303_372483482_0_2_0&checkin=2024-07-20&checkout=2024-08-24&dist=0&group_adults=2&group_children=0&hapos=1&highlighted_blocks=995965303_372483482_0_2_0&hpos=1&matching_block_id=995965303_372483482_0_2_0&nflt=ht_id%3D204&no_rooms=1&req_adults=2&req_children=0&room1=A%2CA&sb_price_type=total&sr_order=popularity&sr_pri_blocks=995965303_372483482_0_2_0__1183860&srepoch=1721430330&srpvid=fa94a2518c9b0002&type=total&ucfs=1&activeTab=main" target="_blank">
                    <img src="/images/card hotel paris.jpg" alt="CARD Hôtel" style="width:80%; height:180px;">
                    <p>CARD Hôtel, Paris</p>
                </a>
            </div>
            <div class="destination">
                <a href="https://www.booking.com/hotel/jp/apahoteru-mao-chang-ting-ba-ding-ku-yi-qian.html?aid=304142&label=gen173rf-1FCAso7AFCJWRvdWJsZXRyZWUtYnktaGlsdG9uLW9ybGFuZG8tZG93bnRvd25IM1gDaLACiAEBmAExuAEXyAEM2AEB6AEB-AECiAIBogIObG9jYWxob3N0OjMwMDCoAgO4ArLg67QGwAIB0gIkMWVmODJlNWItZWE5Ny00YmQzLTg2ZGYtYjRmOTJjYzY2Nzc42AIF4AIB&sid=809d37a05557d3779c8b48d07c093440&all_sr_blocks=1060005702_391859786_2_2_0&checkin=2024-07-20&checkout=2024-08-24&dest_id=-246227&dest_type=city&dist=0&group_adults=2&group_children=0&hapos=2&highlighted_blocks=1060005702_391859786_2_2_0&hpos=2&matching_block_id=1060005702_391859786_2_2_0&no_rooms=1&req_adults=2&req_children=0&room1=A%2CA&sb_price_type=total&sr_order=popularity&sr_pri_blocks=1060005702_391859786_2_2_0__56650000&srepoch=1721430551&srpvid=28dea2c63648007d&type=total&ucfs=1&activeTab=main
" target="_blank">
                    <img src="/images/apa hotel.jpg" alt="APA Hotel Kayabacho Hachobori Ekimae" style="width:80%; height:180px;">
                    <p>APA Hotel Kayabacho Hachobori Ekimae, Tokyo</p>
                </a>
            </div>
        </section>
        
        <section class="search-results" id="searchResults" style="display:none;">
            <h2>Search Results</h2>
            <div class="result-category">
                <h3>Hotels</h3>
                <div id="hotelResults" class="results-list"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
    
    </footer>

    <!-- JavaScript -->
    <script>
/// Function to handle the search
async function search() {
    const destination = document.getElementById('destinationInput').value;
    const checkInDate = document.getElementById('checkInDateInput').value;
    const checkOutDate = document.getElementById('checkOutDateInput').value;
    const guests = document.getElementById('guestsInput').value;

    // Validate input
    if (!destination || !checkInDate || !checkOutDate || !guests) {
        alert('Please fill in all fields');
        return;
    }

    try {
        const response = await fetch(`/api/hotels?city=${destination}&checkInDate=${checkInDate}&checkOutDate=${checkOutDate}&guests=${guests}`);
        if (!response.ok) {
            throw new Error(`Failed to fetch hotel data: ${response.status} - ${await response.text()}`);
        }
        const data = await response.json();

        // Log the entire response to understand its structure
        console.log('API Response:', JSON.stringify(data, null, 2));

        let resultsHTML = '';
        if (data.result && Array.isArray(data.result)) {
            data.result.forEach(item => {
                // Construct the URL using hotel name and other details if URL is not provided
                let hotelUrl = item.url;
                if (!hotelUrl) {
                    const hotelNameSlug = item.hotel_name_trans.toLowerCase().replace(/\s+/g, '-');
                    hotelUrl = `https://www.booking.com/hotel/us/${hotelNameSlug}.html`;
                }

                resultsHTML += `
                    <div class="result-item">
                        <h4><a href="${hotelUrl}" target="_blank">${item.hotel_name_trans}</a></h4>
                        <img src="${item.main_photo_url}" alt="${item.hotel_name_trans}" />
                        <p>Price: ${item.currency_code} ${item.min_total_price}</p>
                        <p>Review Score: ${item.review_score} (${item.review_score_word})</p>
                    </div>`;
            });
        } else {
            resultsHTML = '<p>No hotel data found.</p>';
        }

        document.getElementById('hotelResults').innerHTML = resultsHTML;
        document.getElementById('searchResults').style.display = 'block';
    } catch (error) {
        console.error('Error fetching hotel data:', error);
        document.getElementById('hotelResults').innerHTML = '<p>Error fetching hotel data.</p>';
    }
}

// Ensure the search function is available when the DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    const searchButton = document.querySelector('button[type="button"]');
    if (searchButton) {
        searchButton.addEventListener('click', search);
    }
});
    </script>
    {{#if logged_in}}
    <script src="/public/js/logout.js"></script>
    {{/if}}
</body>
</html>